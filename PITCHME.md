### 僕の設計の仕方

2019年xx月xx日

---


### さて。

---
本当はドメイン駆動設計をやろうと思いました。

ただ、結構難易度高くて、先日も勉強会参加してきて、ある程度は理解できてはいるものの

発表資料作ってる途中で挫けた。

---
なので、もどきではあるが、
その辺を集めて、今どのようなことを考えながらシステム設計を行なっているのか、




---

### ではなくて、根本的なところを考えてみました。

---

なぜ先ほどあげた4つの知識を得ようとしているのか
（もちろんそれ以外での情報収集もそう）

---

AWS Azure GCP などのインフラ関連

→100%止まらないシステム作りをしたいから

可用性が高く、スケーラブルなシステム構成

人的なミスを無くしたい

---

ドメイン駆動設計や なになに駆動設計などの設計手法

（設計手法って調べるとすごくいっぱいあります）

→保守性をあげていきたい

Bugの出ないシステムを作りたい（極力）

綺麗なソースコード作りをしたい

---

Docker k8s

→開発環境依存を無くしたい

開発する前に環境作りとか無駄な時間を廃止したい

最新の物を触っていたい

環境のコード化

---

OAuth2.0

に限ったことじゃないけど、セキュリティ強化のため

---

簡単にいうとこんな感じ

要するに何が言いたいかというと

ブリスウェルの事業はお客さんあっての商売だってところ

（ちょっとだけブリ向けに話します）

---

どんな知識を入れようが、どんなツールを使おうが正直お客さんにとっては

「動くシステムがより早く、より安く出来上がること」

「適度に要望を取り入れてスピーディーにシステム改修が行えること」

「いつでもシステムが使えること」

大体非IT企業であればこんなことしか思ってないと感じてる

---

なんで、事業、仕事としての知識を高めたいのであれば、

まずは目の前のお客さんがどういったものを求めていて

何を提供すれば価値を発揮できるのか、というところを考えて

何を学ぶのかを考えたら良いかなと

---

で、評価されて給与あげましょう。

給与あげる = 売上をあげる、ではなくて利益をあげましょう。

---

はい、では本題です。

---

### AWS

---

すみません、ここまで色々書きましたが、

何か思いつかないかなって思って書いてました。

何も思いつかないのでAWSやります！！

---

前回は基本REST API で、少しAWSに触れました。

そこで質問とかいただいて回答してる感じ

あまりピンときてないかも？

ってことでその辺やります！！

---

### スケーラブルなインフラ構成

---

前提

プログラムがあって、色々なデータを必要とするシステムとする

---
ホワイトボードの時間

①単一 EC2 インスタンス

②ロードバランサー + EC2

③ロードバランサー + EC2 + RDS


---
最初にDB周り強化していきます

④ロードバランサー + EC2 + RDS + マルチ AZ

⑤ロードバランサー + EC2 + RDS + マルチ AZ + リードレプリカ

---
ここからWebサーバ周り強化していきます

⑥ロードバランサー + オートスケーリンググループ + EC2 + RDS + マルチ AZ + リードレプリカ

---
ここで言葉の整理

スケールアップ

→能力の高いものにする

スケールダウン

→能力の低いものにする

スケールアウト

→サーバ台数増やす

スケールイン

→サーバ台数減らす

---
⑥

この子までで基本的にはよくなってきている状態だと思います。

では、例えばこのシステムがECサイトだと仮定し、テレビCMを打ちました。

どかん！とアクセスが増えました。

オートスケーリングだけだと、対応は難しいです。

何故ならば、ある程度の敷地を超えた場合に5分くらいかけてサーバを立ち上げるため

どかん！、だとサーバ立ち上がる前に死にます。

---
⑦elasticbeanstalk + ロードバランサー + オートスケーリンググループ + EC2 + RDS + マルチ AZ + リードレプリカ

ここで前も出てきたEBが出ました

この子はスケール面でも優秀で、TV CM を打つ、とわかっていれば

事前に期間限定でスケールの設定をスケジューリングすることができます

開発環境の場合、毎日定時で落として、出社時間に起動するということやって節約し始めました（お金は大事）

---

### 保守性

---

保守性ってなんだろう？

って考えた時にまずぱっと出るのが前回も出た

依存しない

というところかなと

---

さっきの①に戻る

---

### 補足

---

色々述べましたが、 + で必ずやるべきなのは

負荷試験

かなと。やるだけでは意味がなくて

どこがボトルネックでスピードが遅いのか

このくらいの負荷がかかった時にどこが最初に死ぬのか

とか調べて、修正してってPDCAサイクルを回してインフラはやった方が良さそう

---

### まとめ

---

ElasticBeanstalk
を褒めましたが、

GW中にEKS への移行を勉強 計画しようと思ってます

---

お疲れ様でした
